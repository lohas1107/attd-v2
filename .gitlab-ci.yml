stages:
  - test

test:
  stage: test
  image: docker:18.09.8
  services:
    - docker:18.09.8-dind
  script:
    - apk add --no-cache bash docker-compose
    - bash dev-ops/dc_ci up -d
    - bash dev-ops/dc_ci exec -T nodejs npm run serve --prefix /opt/current/attd-v2/frontend &
    - bash dev-ops/dc_ci exec -T jdk /opt/current/gradlew test cucumber -x npmSetup -x npmInstall -x nodeSetup -x :frontend:clean -x :frontend:npmBuild

    #- cat /etc/hosts
    #- docker ps
    #- mount
    #- pwd
    #- apk add --no-cache build-base nss libffi-dev openssl-dev npm
    #- cd frontend && npm install && ( npm run serve & )
    #- cd ..
    #- IP=$(bash env/setup_docker.sh docker)
    #- echo $IP
    #- cat /etc/hosts
    #- export RUNNING_CODE_IP=$(hostname -i)
    #- echo $RUNNING_CODE_IP
    #- env/dc_pc up -d
    #- bash env/setup_web.sh $RUNNING_CODE_IP
    #- docker exec -i web-driver sudo cat /etc/hosts
    #- ./gradlew test cucumber -x npmSetup -x npmInstall -x nodeSetup -x :frontend:clean -x :frontend:npmBuild


