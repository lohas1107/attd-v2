x-mock-server: &mock-server5-4-1
  image: 'leeonky/mock-server:5.4.1'
  container_name: mock-server.test.${PROJECT_NAME}
  ports:
    - "1080:1080"
  command: [ "-serverPort", "1080", "-logLevel", "INFO" ]
  healthcheck:
    test: [ "CMD", "nc" ,"-z", "localhost", "1080" ]
    timeout: 20s
    retries: 10
  networks:
    default:
      aliases:
        - mock-server.tool.net
x-mysql8: &mysql8
  image: mysql/mysql-server:8.0
  container_name: mysql.test.${PROJECT_NAME}
  environment:
    MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
    MYSQL_DATABASE: ${MYSQL_DATABASE}
    MYSQL_USER: ${MYSQL_USER}
    MYSQL_PASSWORD: ${MYSQL_PASSWORD}
  ports:
    - "3306:3306"
  volumes:
    - "../../configs/containers/mysql/conf:/etc/mysql/conf.d"
  healthcheck:
    test: [ "CMD", "mysqladmin" ,"ping", "-h", "localhost" ]
    timeout: 20s
    retries: 10
  networks:
    default:
      aliases:
        - mysql.tool.net
x-nodejs10: &nodejs10
  image: node:10
  container_name: nodejs.test.${PROJECT_NAME}
  volumes:
    - ${root_volume}:${root_point}
  ports:
    - '8080:8080'
  command: [ 'tail', '-f', '/dev/null' ]

x-openjdk11-alpine: &openjdk11-alpine
  image: adoptopenjdk/openjdk11:jdk-11.0.10_9-alpine
  container_name: jdk.test.${PROJECT_NAME}
  volumes:
    - "${root_volume}:${root_point}"
    - 'gradle-repo:/root/.gradle'
    - 'gradle-home:/root/gradle'
  command: [ 'tail', '-f', '/dev/null' ]

x-nodejs10: &standalone-chrome4
  image: selenium/standalone-chrome:4.0.0-beta-3-20210426
  container_name: web-driver.test.${PROJECT_NAME}
  ports:
    - '4444:4444'
    - '7900:7900'
  networks:
    default:
      aliases:
        - web-driver.tool.net
version: '3.4'

services:
  jdk:
    <<: *openjdk11-alpine
    ports:
      - '10081:10081'
    networks:
      default:
        aliases:
          - ${BACKEND_VIRTUAL_HOST}

  nodejs:
    <<: *nodejs10
    networks:
      default:
        aliases:
          - ${FRONTEND_VIRTUAL_HOST}

  mysql:
    <<: *mysql8

  mock-server:
    <<: *mock-server5-4-1

  web-driver:
    <<: *standalone-chrome4
volumes:
  gradle-repo:
    external: ${gradle_repo_volume_external}
    name: ${gradle_repo_volume}
  gradle-home:
    external: ${gradle_home_volume_external}
    name: ${gradle_repo_volume}
  host_share:
    external: true
